# Caddyfile for Go Web Server
# Replace example.com with your actual domain

# For local development
localhost, localhost:80, localhost:443 {
	# Reverse proxy to Go app
	reverse_proxy app:8080 {
		# Health check
		health_uri /health
		health_interval 30s
		health_timeout 10s
		
		# Load balancing
		lb_policy round_robin
	}

	# Enable compression
	encode gzip zstd

	# Security headers (additional to Go app's built-in headers)
	header {
		# Remove server info
		-Server
		
		# Additional security headers
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		Referrer-Policy "strict-origin-when-cross-origin"
	}

	# Logging
	log {
		output stdout
		format console
		level INFO
	}
}

# Production domain configuration
go.dunamismax.com {
	# Automatic HTTPS with Let's Encrypt
	tls {
		protocols tls1.2 tls1.3
	}

	# Reverse proxy to Go app
	reverse_proxy app:8080 {
		# Health check
		health_uri /health
		health_interval 30s
		health_timeout 10s
		
		# Load balancing
		lb_policy round_robin
	}

	# Enable compression
	encode gzip zstd

	# Security headers (additional to Go app's built-in headers)
	header {
		# Remove server info
		-Server
		
		# Additional security headers
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		Referrer-Policy "strict-origin-when-cross-origin"
		
		# HSTS (Strict Transport Security)
		Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
	}

	# Logging
	log {
		output stdout
		format console
		level INFO
	}
}