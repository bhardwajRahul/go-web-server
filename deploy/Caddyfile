# Caddyfile for Go Web Server

# Replace 'your-domain.com' with your actual domain
your-domain.com {
	# Reverse proxy to Go application
	reverse_proxy localhost:8080

	# Enable compression
	encode zstd gzip

	# Security headers
	header {
		# Remove server information
		-Server
		
		# Security headers
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		
		# Optional: Content Security Policy (adjust as needed)
		# Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline';"
	}

	# Logging
	log {
		output file /var/log/caddy/your-domain.com.log {
			roll_size 100MB
			roll_keep 5
		}
		level INFO
	}

	# Health check endpoint
	handle /health {
		reverse_proxy localhost:8080
	}

	# Static files with long cache
	handle /static/* {
		reverse_proxy localhost:8080
		header Cache-Control "public, max-age=31536000, immutable"
	}

	# All other requests
	handle {
		reverse_proxy localhost:8080
	}
}

# Redirect www to non-www (optional)
www.your-domain.com {
	redir https://your-domain.com{uri} permanent
}

# HTTP to HTTPS redirect is automatic with Caddy